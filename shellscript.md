# シェルスクリプト

## シェルスクリプトとは

* 複数の処理をまとめて行いたいときに使われる、OSのシェルが直接解釈・処理することができるスクリプト。
  * ※スクリプトとは台本という意味で、実際にCentOSに実行させたい処理を記述し、その台本通りに動かせるというもの。

* シェルスクリプトのプログラムはテキスト形式で記述し、原則的に実行したいコマンドを順番に記述していく。

## シェルスクリプトの基礎

* スクリプトを実行するのには sourceコマンドを使用する。

* シェルスクリプト実行時には以下の権限が必用
  * シェルスクリプトの読み取り権限
  * シェルスクリプトが存在するディレクトリの実行権限


* スクリプトの例 
  
  * scripttest 

    ```
    cp　/home/centos/vitext.txt/home/centos/testscript.txt
    ls　/home/centos
    cat　/home/centos/testscript.txt
    ```
  * 実行コマンド
    
    ```
      source　/home/centos/scripttest
    ```

## シェルスクリプトに引数を渡す

| 変数名 | 説明 |
|   -    |  -   |
| $0 | シェルスクリプトのファイル名（フルパス）|
| $1 | 第1の引数 |
| $2 | 第2の引数(以下$3, $4と続く) |
| $# | 引数の数 |
| $@ | 全ての引数(スペース区切り) |
| $* | 全ての引数 | 

## 条件式

* ファイル形式のテスト

  * | 条件式 | 説明 |
    | - | - |  
    | -f | ディレクトリを除く、ファイルが存在すれば真 |
    | -d | ディレクトリが存在すれば真 | 
    | -r | ファイルが存在し、かつ読込可能であれば真 |
    | -w | ファイルが存在し、かつ書込可能であれば真 |
    | -x | ファイルが存在し、かつ実効可能であれば真 |
    | -s | ファイルサイズが0より大きいファイルがあれば真 | 
    | -L | シンボリックファイルであるファイルがあれば真 | 

* ファイルの特性のテスト
  
  * | 条件式 | 説明 |
    | - | - |
    | -e | ファイルが存在すれば真 | 
    | ファイル1 -nt ファイル2 | ファイル1がファイル2より修正時間が新しければ真  |
    | ファイル1 -ot ファイル2 | ファイル1がファイル2より修正時間が古ければ真  | 

* 数値のテスト
  
  * | 条件式 | 説明 |
    | - | - |
    | 数値1 -eq 数値2 | 数値1と数値2が等しければ真 | 
    | 数値1 -ge 数値2 | 数値1≧数値2なれば真 |
    | 数値1 -gt 数値2 | 数値1＞数値2なれば真 |
    | 数値1 -le 数値2 | 数値1≦数値2なれば真 |
    | 数値1 -lt 数値2 | 数値1＜数値2なれば真 |
    | 数値1 -ne 数値2 | 数値1と数値2が等しくなければ真 |

* 文字列のテスト

   * | 条件式 | 説明 |
     | - | - |
     | -n 文字列 | 文字列の長さが0より大きければ真 |
     | -z 文字列 | 文字列の長さが0ならば真 | 
     | 文字列1 = 文字列2| 2つの文字列が等しければ真 |
     | 文字列1 != 文字列2| 2つの文字列が等しくなければ真 |

* テストの論理結合 

  * | 条件式 | 説明 |
    | - | - |
    | !条件| 条件式が偽であれば真 |
    | 条件1 -a 条件2 | 条件1、条件2のどちらも真であれば真（AND）|
    | 条件1 -o 条件2 | 条件1、条件2のどちらか一方が真であれば真（OR）|


## if文

* if文の構造 

    ```
    if (条件式)
        then
            条件が真の場合の処理
        else
            条件が偽の場合の処理
    fi
    ```

* 実用例


    ```
    if　test　-f　/home/centos/vitext.txt
    　　then
    　　　　ls　-l　/home/centos/vitext.txt　　
    　　else　　
    　　　　echo　"FileName=vitext.txt　file　not　found！"　　
    fi　　
    ```

## for文

* for文の構造

    ```
    for 変数名 in 変数に代入する値のリスト
        do
            実行文
        done
    ```

* 実用例

    ```
    for　i　in　`seq　1　5`
    　　do
    　　　　cp　/home/centos/fortest　/home/centos/looptest${i}.txt
    　　done
    ls　/home/centos

    ※ `seq　1　5`はseqコマンドにより、1から5までの連番を作成するという意味になる。
    ```

## while文

* while文の構造

    ```
    while　条件文
        do
            実行文
        done
    ```

* 実用例

    ```
    i=1
    while　test　-f　/home/centos/looptest${i}.txt　　
    　　do
    　　　　ls　-l　/home/centos/looptest${i}.txt　　
    　　　　let　i=i+1　　
    　　done

    ※ letは演算を行う時に使用する。
    ※ 変数宣言時やlet演算を行う場合はスペースを開けない　　
    ```


## read文

* read文の構造
   
    ```
    read　変数名
    ```

* 実用例
   
    ```
    echo　-n　"please　input　number(1-5):"
    read　i
    ls　-l　/home/centos/looptest${i}.txt

    ※ echoの -n オプションを使用して、メッセージ出力時に改行されないようにしている
    ```


## シェルスクリプトの実行環境

* bashシェルで実行させることを明記する場合、シェルスクリプトに下記のように指定する。通常、1行目には下記のように記述する。
    * `#!/bin/bash`


## 標準出力とエラー出力

* コマンドの出力には標準出力とエラー出力があり、番号が振られている。
  * 1:標準出力
  * 2:エラー出力

* それぞれ別のファイルに出力する場合には以下のように書く。
  * command 1>log.txt 2>errorlog.txt

* 標準出力とエラー出力を混ぜて出力する場合には以下のように書く。
  * command 2>&1


## 変数にコマンドの結果を代入する。
  * 変数=\`command\`
  * DATE=\`date\`

## DATEコマンドの書式について

  * | 記入 | 出力書式 |
    | - | - |
    | "+%Y%m%d" | YYYYMMDD書式 | 

# テキスト処理コマンド

## cat
* ファイルの内容を出力する
  * `cat ファイル名 [オプション]`
    * | オプション | 説明 |
      | - | - |
      | -n | 各行の先頭に行番号をつけて出力 |

* ファイルの内容を他のファイルに出力する。
  * ` cat ファイル名 >> 出力ファイル名 `

## nl
* テキストファイルの一部または全部に行番号をつけて出力 
  * ` nl [オプション] [形式] ファイル名 `
    * | オプション | 説明 |
      | - | - |
      | -b | 指定した形式で行頭に行番号をつける |
      ------------------------------------------------
      | 形式 | 説明 |
      | - | - |
      | a | 全ての行に表示する |
      | t | 空白行以外に表示する |
      | n | 行番号を付けるのを中止する |

## head
* ファイルの先頭部分を出力する。
  * `head [オプション] ファイル名`
    * | オプション | 説明 |
      | - | - |
      | -n | ファイルの先頭から指定した行数分出力する。 |
      | -c | ファイルの先頭から指定したバイト数分出力する。 |

## tail
* ファイルの末尾部分を出力する。
  * `tail [オプション] ファイル名`
    * | オプション | 説明 |
      | - | - |
      | -n | ファイルの末尾から指定した行数分出力する。 |
      | -c | ファイルの末尾から指定したバイト数分出力する。 |
      | -f | リアルタイムにファイルの末尾に追加された行を出力し続ける |

## cut
* テキストファイルの指定した箇所の出力を行う
  * `cut [オプション] ファイル名`
    * | オプション | 説明 |
      | - | - |
      | -c | 取り出す文字位置を指定する |
      | -d | 区切り文字（デリミタ）を指定する（defaultはtab） |
      | -f | 取り出すフィールドを指定する。 |

## paste
* 2つのファイルを読み込み、各行の連結を行う

    * ` paste [オプション] ファイル名1 ファイル名2`
    * | オプション | 説明 |
      | - | - |
      | -d | 連結する際の区切り記号（デリミタ）を指定する。（defaultはtab） |

## sort
* ファイル内を並び変える

    * ` sort [オプション]`
    * | オプション | 説明 |
      | - | - |
      | -b | 先頭の空白は無視する |
      | -f | 大文字小文字の区別を無視する |
      | -r | 降順に並び変える |
      | -n | 数字を文字ではなく数値として判断する |


## uniq
* 並び替え後のファイルから重複する行を削除する

    * ` uniq [オプション] 出力ファイル名 入力ファイル名 `
    * | オプション | 説明 |
      | - | - |
      | -d | 重複している行のみ出力する |
      | -u | 重複していない行のみ出力する |


# 正規表現

* 正規表現(regular expression)とは、様々な特定の条件を表すことのできる文字列や記号を使い抽象的に表現したもの。いくつかの文字列を一つの形式で表現するための表現技法。

* 正規表現一覧

  | 記号 | 説明 |
  | - | - |
  | ^ | 行頭 | 
  | $ | 行末 | 
  | .(ピリオド) | 任意の一文字 |
  | * | 直前の文字の繰り返し |
  | [] | カッコ内の文字いずれか1文字 |
  | [^ ] | カッコ内に含まれる文字以外 |
  | [(文字)-(文字)] | 文字から文字の範囲 |
  | \ (バックスラッシュ) | エスケープ | 

* 正規表現利用例

  | 正規表現 | 説明 |
  | - | - |
  | ^a | 行頭がaで始まっている行を全て表す |
  | b$ | 行末がbで終わっている行全て表す |
  | c.d | cとdの間に1文字入っているものを全て表す |
  | e...f | eとfの間に3文字入っているものを全て表す |
  | [ghi]abc | gかhかiで始まりabcと続くもの |
  | [^ghi]abc | gかhかi以外で始まりabcと続くもの |
  | [a-z]abc | aからzのうちのどれかで始まりabcと続くもの |
  | go* | 先頭がgでそのあとにoが何個あってもよい（なくてもよい） |
  | 30\*50 | 30\*50を表す |

* 拡張正規表現

  | 記号 | 説明 |
  | - | - |
  | + | 直前の文字の繰り返し（ゼロ回不可）|
  | ? | 直前の文字の0回か1回の繰り返し（2回以上不可）|
  | \|  | 左右いずれかの記述に合致する |