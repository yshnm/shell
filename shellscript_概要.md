# シェルスクリプト

## シェルスクリプトとは

* 複数の処理をまとめて行いたいときに使われる、OSのシェルが直接解釈・処理することができるスクリプト。
  * ※スクリプトとは台本という意味で、実際にCentOSに実行させたい処理を記述し、その台本通りに動かせるというもの。

* シェルスクリプトのプログラムはテキスト形式で記述し、原則的に実行したいコマンドを順番に記述していく。

## シェルスクリプトの基礎

* スクリプトを実行するのには sourceコマンドを使用する。

* シェルスクリプト実行時には以下の権限が必用
  * シェルスクリプトの読み取り権限
  * シェルスクリプトが存在するディレクトリの実行権限


* スクリプトの例 
  
  * scripttest 

    ```
    cp　/home/centos/vitext.txt/home/centos/testscript.txt
    ls　/home/centos
    cat　/home/centos/testscript.txt
    ```
  * 実行コマンド
    
    ```
      source　/home/centos/scripttest
    ```

## シェルスクリプトに引数を渡す

| 変数名 | 説明 |
|   -    |  -   |
| $0 | シェルスクリプトのファイル名（フルパス）|
| $1 | 第1の引数 |
| $2 | 第2の引数(以下$3, $4と続く) |
| $# | 引数の数 |
| $@ | 全ての引数(スペース区切り) |
| $* | 全ての引数 | 

## 条件式

* ファイル形式のテスト

  * | 条件式 | 説明 |
    | - | - |  
    | -f | ディレクトリを除く、ファイルが存在すれば真 |
    | -d | ディレクトリが存在すれば真 | 
    | -r | ファイルが存在し、かつ読込可能であれば真 |
    | -w | ファイルが存在し、かつ書込可能であれば真 |
    | -x | ファイルが存在し、かつ実効可能であれば真 |
    | -s | ファイルサイズが0より大きいファイルがあれば真 | 
    | -L | シンボリックファイルであるファイルがあれば真 | 

* ファイルの特性のテスト
  
  * | 条件式 | 説明 |
    | - | - |
    | -e | ファイルが存在すれば真 | 
    | ファイル1 -nt ファイル2 | ファイル1がファイル2より修正時間が新しければ真  |
    | ファイル1 -ot ファイル2 | ファイル1がファイル2より修正時間が古ければ真  | 

* 数値のテスト
  
  * | 条件式 | 説明 |
    | - | - |
    | 数値1 -eq 数値2 | 数値1と数値2が等しければ真 | 
    | 数値1 -ge 数値2 | 数値1≧数値2なれば真 |
    | 数値1 -gt 数値2 | 数値1＞数値2なれば真 |
    | 数値1 -le 数値2 | 数値1≦数値2なれば真 |
    | 数値1 -lt 数値2 | 数値1＜数値2なれば真 |
    | 数値1 -ne 数値2 | 数値1と数値2が等しくなければ真 |

* 文字列のテスト

   * | 条件式 | 説明 |
     | - | - |
     | -n 文字列 | 文字列の長さが0より大きければ真 |
     | -z 文字列 | 文字列の長さが0ならば真 | 
     | 文字列1 = 文字列2| 2つの文字列が等しければ真 |
     | 文字列1 != 文字列2| 2つの文字列が等しくなければ真 |

* テストの論理結合 

  * | 条件式 | 説明 |
    | - | - |
    | !条件| 条件式が偽であれば真 |
    | 条件1 -a 条件2 | 条件1、条件2のどちらも真であれば真（AND）|
    | 条件1 -o 条件2 | 条件1、条件2のどちらか一方が真であれば真（OR）|


## if文

* if文の構造 

    ```
    if (条件式)
        then
            条件が真の場合の処理
        else
            条件が偽の場合の処理
    fi
    ```

* 実用例


    ```
    if　test　-f　/home/centos/vitext.txt
    　　then
    　　　　ls　-l　/home/centos/vitext.txt　　
    　　else　　
    　　　　echo　"FileName=vitext.txt　file　not　found！"　　
    fi　　
    ```

## for文

* for文の構造

    ```
    for 変数名 in 変数に代入する値のリスト
        do
            実行文
        done
    ```

* 実用例

    ```
    for　i　in　`seq　1　5`
    　　do
    　　　　cp　/home/centos/fortest　/home/centos/looptest${i}.txt
    　　done
    ls　/home/centos

    ※ `seq　1　5`はseqコマンドにより、1から5までの連番を作成するという意味になる。
    ```

## while文

* while文の構造

    ```
    while　条件文
        do
            実行文
        done
    ```

* 実用例

    ```
    i=1
    while　test　-f　/home/centos/looptest${i}.txt　　
    　　do
    　　　　ls　-l　/home/centos/looptest${i}.txt　　
    　　　　let　i=i+1　　
    　　done

    ※ letは演算を行う時に使用する。
    ※ 変数宣言時やlet演算を行う場合はスペースを開けない　　
    ```


## read文

* read文の構造
   
    ```
    read　変数名
    ```

* 実用例
   
    ```
    echo　-n　"please　input　number(1-5):"
    read　i
    ls　-l　/home/centos/looptest${i}.txt

    ※ echoの -n オプションを使用して、メッセージ出力時に改行されないようにしている
    ```

## シェルスクリプトの実行環境

* bashシェルで実行させることを明記する場合、シェルスクリプトに下記のように指定する。通常、1行目には下記のように記述する。
    * `#!/bin/bash`
